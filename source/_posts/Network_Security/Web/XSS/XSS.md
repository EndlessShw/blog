---
title: XSS
categories:
- Network_Security
- Web
- XSS
tags:
- Network_Security
date: 2024-01-14 11:50:46
---

# XSS

## 1. 概念

1. https://juejin.cn/post/6912030758404259854

## 2. xss.haozi.me

### 1. 0x00

1. 不多说，最基本的语句

### 2. 0x01

1. 闭合 `<textarea>` 标签即可。

2. 结果如下：

    ![image-20220510235944048](image-20220510235944048.png)

### 3. 0x02

1. 使用 `">` 来闭合属性和标签

2. 结果如下：

    ![image-20220511000824154](image-20220511000824154.png)

### 4. 0x03（`()` 括号被过滤）

1. '`' 可以用来代替括号

2. 结果如下：

    ![image-20220511001018711](image-20220511001018711.png)

### 5. 0x04（众多符号被过滤）

1. 用 html 实体编码绕过（`&#` + ascii 10 进制数）

2. 将实体编码直接执行的标签和情况：

    1. `<svg>` ：

        ![image-20220511002151285](image-20220511002151285.png)

    2. 其他标签中的属性或者事件：

        ![image-20220511002117634](image-20220511002117634.png)

### 6. 0x05（闭合注释）

1.  JavaScript 中的注释符：

    `<!-- 注释内容 -->`

    `<!-- 注释内容 --!>`

2. 因此该题用没有被过滤的一种进行闭合即可

### 7. 0x06（换行符绕过）

1. JavaScript 解析引擎当确定一个语句是完整的，且行尾有换行符，则分号可省略（也就是 JavaScript 中，一句代码的句尾不用加分号）。而如果不是完整的语句，`javascript`则会继续处理，直到语句完整结束或分号。
2. 因为本体对 `on` 开头，`=` 结尾的语句进行过滤（正则表达式），因此用换行符绕过。

### 8. 0x07（单标签过滤）

1. 其正则表达式过滤了 `</任意内容>` 

2. 但是 html 单标签容错率高，即单标签不闭合也可以使用（该特性在 html5 中 deprecated）

3. 因此 payload：

    `<img src="" onerror="alert(1)"`

### 9.0x08（标签变形）

1. 过滤了 `<style>` 
2. 可以用 `<style >` 或者 `<style制表符>` 或者 `<style换行>` 绕过。

### 10. 0x09

1. 正常闭合即可。

### 11.0x0A（`@` 跳转符号的使用）

1. `@` 符号在 URL 中可以将网页跳转到 `@` 后的网站，例如：

    `www.baidu.com@www.bing.com` 其就会跳转到 BIng 的搜索界面。

2. 本体只可以输入一个固定的网站，但是后面可以添加 `@` 符号来跳转到其他的网站的或者当前网站下的 JavaScript 文件。

### 12.0x0B（JavaScript 和 html 的大小写问题，html 实体编码绕过）

1. 知识点：

    JavaScript 对大小写敏感，但是 html 不会。

2. 因此解题的思路就是：

    使用 html 标签，在标签的 JavaScript 属性事件内使用经过 html 实体编码的语句即可成功。

    html 会对 html 实体编码进行解析，如果是在单双引号之外的，其就会被当成一个转义后的符号运行，即正常显示的符号而不使用其功能。但是若是在单双引号中，也就是字符串中，那么解析过后变成正常字符串，依旧可以正常使用，例如：

    `<img src&equals;"www.baidu.com"`，这个就不能正常执行，因为其等于号就变成一个用于显示的等于号，从而失去“赋值”的功能。但是：

    `<img src="www&period;baidu&period;com>`，这个就能正常跳转，因为其解码变成了 `www.baidu.com` ，这以及不影响使用。

    因此，本题的 payload 为：

    `</h1><img src="" onerror="&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;">`

    需要注意的是，html 实体编码在纯 JavaScript 的环境中是无法被解码回来的。因此，这样写的效果是没有用的：

    `<script>&#97;&#108;&#101;&#114;&#116;&lpar;&#49;&rpar;</script>`

    因为他不经过 html 解码。

    同时，经过测试，html 实体名称和实体编码混合用可能会出现问题，因此尽量都用实体编码

### 13. 0x0C

1. 和上一题思路一样，只是过滤了 `script` 字段

### 14.0x0D （JavaScript 的注释绕过）

1. 回车可以破坏注释结构
2. 使用 html 的 `-->` 注释后面的内容（因为他过滤了 `<` ）

### 15. 0x0E（使用古英语字母来代替原本的 26 位大小写）

1. 古英语（拉丁文）在 html 中也可以当成正常的字母执行。

2. 本题中以`<字母` 开头的字符串都被替换成 `<_字母`，因此可以用古英语来绕过。例如本体的 payload：

    `<ſvg onload="&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;">`

### 16. 0x0F（html 编码实体绕过的问题，0x0B 中有提到）

1. 实体编码确实能抵御 xss，但是在 JavaScript 属性内的实体编码是不能抵御的，因为其是在字符串中。

### 17. 0x10

1. 其在 `<script>` 标签内，因此直接给值，闭合再弹窗就行。

### 18. 0x11

1. 虽然在 JavaScript 中将特殊符号前添加转义符号，但是使用双引号依旧可以闭合（因为双引号内是字符串，`\` 反而失效了，然后后面接着构造 JavaScript 的弹窗语句即可。
2. 单反斜杠的作用是正则表达式中的反斜杠的特殊作用，双反斜杠才把反斜杠转换成 JavaScript 中反斜杠的作用。

### 19. 0x12

1. 本题和上一题的区别在于，这题在双引号前添加了两个反斜杠，这就导致 `\` 起到了作用，那么 `\\"` 中的双引号就会被变成字符串的一个字符从而失去闭合的作用。
2. 但是本题的突破口在于，其没有对输入的反斜杠进行转义，那么在双引号前再添加一个反斜杠就可以把他自带的反写杠给转移掉。

## 3. xss-labs

### 1. level-3（`htmlspecialchars()` 的处理方法）

1. 这里对各种符号都进行的实体编码，但是除了单引号之外，然后输入框又是用单引号进行闭合，所以这里先使用单引号闭合，然后插入新的 JavaScript 属性事件（用单引号包裹或者不加单引号），最后用 `//` 注释或者再用新属性配合单引号闭合。

### 2. level-5（ `<a href>` 来调用 JavaScript 事件，当 `on` 被转换时）

1. 用 `<a href="javascript:alert(1)">a</a>` 来触发 JavaScript 事件

### 3. level-6（属性大小写混合绕过语义破坏）

1. `<a hReF="javascript:alert(1)">a</a>`

### 4. level-9（JavaScript 中使用 `//` 注释 + 友情链接绕过）

1. 本题就检查了内容是否包含了 `http` ，那么构造

    `&#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;//http://www.baidu.com`

    即可。

### 5. level-10（隐藏元素）

1. 网页中可能会有隐藏元素，即其 `type="hidden"`，那么可以尝试对这些元素进行注入。
2. 可以更改其 `type` 让其显示出来。

### 6. level-11~13（隐藏元素在 http 头中）

1. 有些隐藏元素获取的值来自于 http 头部包中，可以修改 http 头部包

### 7. level-14（exif-xss）

1. 详见网站：https://xz.aliyun.com/t/1206?accounttraceid=74ab404d-2a01-4a1c-8b87-36ad367dbe11#toc-12

2. 复现：https://blog.csdn.net/qq_32393893/article/details/104814749
3. 将支持 exif 格式的图片上传到网站后，网站可能会读取 exif 格式的图片，从而导致 xss。
4. 该漏洞主要攻击对象是能够读取并识别 exif 信息的网站和插件。实战使用机会较小。

### 8.level-15（angular.js 的外部引用文件指令 `ng-include`）

1. 先把文件中的 js 地址改成国内的镜像地址，否则没有结果。
2. 详见：https://blog.csdn.net/wo41ge/article/details/107459332，`ng-include` 就类似 php 的 `include` 函数。

### 9. level-16（空格被实体编码）

1. 使用换行符，制表符等绕过

### 10. level-17

1. 这一关不同浏览器对 swf 文件的支持不同，这就导致火狐不会显示。（无法识别，出现语法错误）

## 4. 常见的绕过方法

1. https://blog.csdn.net/qq_29277155/article/details/51320064
2. `eval(String.fromCharCode(97,108,101,114,116,40,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41))` 适用于绕过黑名单alert 在跨站中，String.fromCharCode主要是使到一些已经被列入黑名单的关键字或语句安全通过检测，把关键字或语句转换成为ASCII码，然后再用String.fromCharCode还原，因为大多数的过滤系统都不会把String.fromCharCode加以过滤，例如关键字alert被过滤掉，那就可以这么利用**alert(document.cookie)**
